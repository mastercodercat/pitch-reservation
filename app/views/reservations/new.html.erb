<% title "Create Reservation" %>

<% form_for @reservation do |f| %>
  <%= f.error_messages %>
  <p>The following equipment will be reserved by 
    <% if current_user and current_user.is_admin? %>
      <%= f.select :reserver_id, User.select_options, :prompt => true %>
    <% else %>
      <%= current_user.name %>
      <%= f.hidden_field :reserver_id, :value => current_user.id %>
    <% end %>
    from 
    <%= cart.start_date.to_s(:long) %>
    <%= f.hidden_field :start_date, :value => cart.start_date %>
    to 
    <%= cart.due_date.to_s(:long) %>:
    <%= f.hidden_field :due_date, :value => cart.due_date %>
  </p>
  <p>
    <% if cart.items.empty? %>
      <strong class="error">Your cart is empty!</strong> You need to add items to your cart before you can make a reservation.
    <% else %>
      <ul>
        <% cart.items.each do |item| %>
          <li>
            <%= item.quantity %> x <%= link_to item.name, item.equipment_model %>
            <% if !item.available?(cart.start_date..cart.due_date) %><br /><small>
              <strong class="error">This item is not available for the specified period.</strong> Please use
              the cart menu in the right sidebar to either remove this item
              or to change the dates of your reservation.</small>
            <% end %>
          </li>
        <% end %>
        <li style="list-style: none"><small><%= link_to "Go back to the catalog", catalog_path %></small></li>
      </ul>
    <% end %>
  </p>
  <% if cart.empty? or !cart.available? %>
    <p>
      <strong>Your reservation cannot be made for one or more reasons. Please resolve the issues
        listed above, then return here to finalize your reservation. Thank you.</strong>
    </p>
  <% else %>
    <p><%= f.submit "Finalize reservation" %></p>
  <% end %>
<% end %>
