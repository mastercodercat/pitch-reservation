<% title "Catalog" %>

<!--show quicksearch box-->
<%= render :partial => 'quicksearch' %>
<%= paginate @paginated_equipment_models_by_category %>
<%= form_tag catalog_path do %>
  <%= label_tag "Items per page" %>
  <%= select_tag :user_cat_items_per_page, options_for_select(@user_per_page_opts, session[:user_per_cat_page]), :include_blank => true %>
  <%= submit_tag "Go" %>
<% end %>
<% if @equipment_models_by_category.empty? %>
  <p>Sorry, no equipment models were found.</p>
<% else %>
  <% @equipment_models_by_category.each do |category, equipment_models| %>
    <h2 class="catalog">
      <!--print category name-->
      <%= link_to category.name, category_equipment_models_path(category) %>
    </h2>    
    <ul class="catalog">
    <% unless equipment_models.nil? %>
      <% equipment_models.each do |equipment_model| %>
        <li>
          <!--show equipment model image-->
						<%= image_tag equipment_model.photo.url(:small) %>
          <h3>
            <!--print equipment model name-->
            <%= link_to equipment_model.name, equipment_model %>
          </h3>
          <!--print number of equipment objects available-->
          (<%= equipment_model.available?(cart.start_date..cart.due_date) || "0" %>
           available from
           <%= cart.start_date.strftime("%b %d, %Y") %> to <%= cart.due_date.strftime("%b %d, %Y") %>)
          <br>
          <!--print add to cart link-->
          <%= link_to "[add to cart]", {:url => add_to_cart_path(equipment_model)},
                      :href => add_to_cart_path(equipment_model), :remote => true %>
          <% # (Using both the ":url" and ":href" symbols seems redundant. Remove one?) %>
          <br>
          <br>
        </li>
      <% end %>
    <% end %>
    </ul>
  <% end %>
<% end %>